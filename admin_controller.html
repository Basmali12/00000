<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ø¯Ù…Ù† (Ø§Ù„Ù…ØªØ­ÙƒÙ…)</title>
    <style>
        body { font-family: Tahoma, Geneva, Verdana, sans-serif; text-align: center; background-color: #e0f7fa; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); border: 2px solid #007bff; }
        h2 { color: #007bff; }
        button { background-color: #4CAF50; color: white; border: none; padding: 10px 20px; margin: 10px; cursor: pointer; border-radius: 5px; }
        #stopStream { background-color: #f44336; }
        #streamView { width: 100%; min-height: 400px; border: 4px solid #007bff; border-radius: 8px; margin-top: 20px; background-color: #ccc; }
        #adminStatus { margin-top: 15px; font-weight: bold; color: #555; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ”‘ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ø¯Ù…Ù†/Ø§Ù„Ù…ØªØ­ÙƒÙ…</h2>
    <div id="adminStatus">âŒ ÙŠØ±Ø¬Ù‰ ØªØ´ØºÙŠÙ„ Ø®Ø§Ø¯Ù… WebSockets Ø¹Ù„Ù‰ Ù…Ù†ÙØ° 8080 ÙˆØ§Ù„Ø¹Ù…ÙŠÙ„ ÙÙŠ Ù…ØªØµÙØ­ Ø¢Ø®Ø±.</div>

    <button onclick="sendCommand('START_STREAM')" id="startStream">â–¶ï¸ Ø¨Ø¯Ø¡ Ø¨Ø« Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§</button>
    <button onclick="sendCommand('STOP_STREAM')" id="stopStream" disabled>â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨Ø«</button>

    <h3>Ø¨Ø« Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„:</h3>
    <img id="streamView" src="https://via.placeholder.com/800x400?text=Live+Feed+Will+Appear+Here" alt="Ø¨Ø« Ù…Ø¨Ø§Ø´Ø±">
</div>

<script>
    // **Ø§Ù„Ø¬Ø²Ø¡ 1: Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„**
    const adminStatusDiv = document.getElementById('adminStatus');
    const streamViewImg = document.getElementById('streamView');
    const startButton = document.getElementById('startStream');
    const stopButton = document.getElementById('stopStream');
    let socket;

    function connectToClient() {
        adminStatusDiv.textContent = 'Ø¬Ø§Ø±ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø§Ø¯Ù… WebSockets...';
        // Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†ÙØ³ Ø¹Ù†ÙˆØ§Ù† ÙˆÙ…Ù†ÙØ° Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø°ÙŠ ÙŠØªØµÙ„ Ø¨Ù‡ Ø§Ù„Ø¹Ù…ÙŠÙ„
        socket = new WebSocket('ws://localhost:8080');

        socket.onopen = () => {
            adminStatusDiv.textContent = 'âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø§Ø¯Ù… WebSockets. ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¢Ù† Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£ÙˆØ§Ù…Ø±.';
        };

        socket.onmessage = (event) => {
            const data = event.data;
            if (data.startsWith('data:image/jpeg')) {
                // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø´ÙØ±Ø© Base64 ÙˆØ¹Ø±Ø¶Ù‡Ø§
                streamViewImg.src = data;
            } else if (data.startsWith('ERROR:')) {
                adminStatusDiv.textContent = `âŒ Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„: ${data}`;
            }
        };

        socket.onclose = () => {
            adminStatusDiv.textContent = 'âŒ ØªÙ… Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„. Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„...';
            stopButton.disabled = true;
            startButton.disabled = false;
            setTimeout(connectToClient, 5000);
        };

        socket.onerror = (error) => {
            console.error('WebSocket Error:', error);
            adminStatusDiv.textContent = 'âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø®Ø§Ø¯Ù… ÙŠØ¹Ù…Ù„.';
        };
    }

    // **Ø§Ù„Ø¬Ø²Ø¡ 2: Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£ÙˆØ§Ù…Ø±**
    function sendCommand(command) {
        if (socket && socket.readyState === WebSocket.OPEN) {
            socket.send(command);
            adminStatusDiv.textContent = `ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…Ø±: ${command}`;
            if (command === 'START_STREAM') {
                stopButton.disabled = false;
                startButton.disabled = true;
            } else if (command === 'STOP_STREAM') {
                stopButton.disabled = true;
                startButton.disabled = false;
                streamViewImg.src = "https://via.placeholder.com/800x400?text=Stream+Stopped";
            }
        } else {
            adminStatusDiv.textContent = 'âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£ÙˆØ§Ù…Ø±.';
            connectToClient(); // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„
        }
    }

    // Ø§Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
    connectToClient();
</script>

</body>
</html>
